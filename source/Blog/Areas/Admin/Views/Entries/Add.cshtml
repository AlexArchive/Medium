@model Blog.Models.EntryInput

@{
    ViewBag.Title = "Add";
}

@Html.ValidationSummary()

<div class="validation-summary-success">
    @if (ViewBag.EntryLink != null)
    {
        <p>Your post has been published and is available <a href="@ViewBag.EntryLink">here</a>.</p>
    }

</div>

@using (Html.BeginForm())
{
    @Html.TextBoxFor(m => m.Header, new { placeholder = "Title"})
    
    <div class="wmd-panel">
        <div id="wmd-button-bar"></div>
        <textarea class="wmd-input" id="wmd-input"></textarea>
    </div>
    <article>
        <div id="wmd-preview" class="wmd-panel wmd-preview"></div>
    </article>

        @Html.HiddenFor(m=>m.Content);

        <button type="submit" class="flat-button">Post</button>
        }

        @section Scripts {
            <script src="~/Scripts/Markdown.Converter.js"></script>
            <script src="~/Scripts/Markdown.Sanitizer.js"></script>
            <script src="~/Scripts/Markdown.Editor.js"></script>
            <script src="~/Scripts/syntax-highlighting.js"></script>

            <script>

                $(document).ready(function () {

                    $("#wmd-input").val($("#Content").val());

                    $("form").submit(function () {
                        $("#Content").val($("#wmd-input").val());
                    });
                });

            </script>

            <script>
                (function () {
                    var converter = Markdown.getSanitizingConverter();

                    converter.hooks.chain("preBlockGamut", function (text, rbg) {
                        return text.replace(/^ {0,3}""" *\n((?:.*?\n)+?) {0,3}""" *$/gm, function (whole, inner) {
                            return "<blockquote>" + rbg(inner) + "</blockquote>\n";
                        });
                    });

                    var editor = new Markdown.Editor(converter);
                    editor.hooks.chain("onPreviewRefresh", function () {
                        Prism.highlightAll();
                    });

                    editor.run();
                })();
            </script>
        }

        @section Styles {
            <link rel="stylesheet" href="~/Content/syntax-highlighting.css" />
        }
